# Prerequisites

- Protobuf compiler installed

macOS:
```
brew install protobuf
```

Linux (Debian-like):
```
sudo apt update && sudo apt install -y protobuf-compiler
```

- protoc-gen-go installed
```
go install github.com/golang/protobuf/protoc-gen-go@latest
```

(`$GOPATH/bin` must be in `$PATH`)

# Build

Build binary:
```
make 
```

Create Docker image:
```
docker build -t go-grpc-example .
```

# Fly.io deployment

### Deploy

```
fly deploy
```

### Store logs 

Fly.io needs third-party service to store application logs. The easiest one to configure is Honeycomb.

- Go to [honeycomb.io](https://honeycomb.io) and create new account. Copy autogenerated API key.

- Clone and configure fly-log-shipper. It's a daemon app that will collect logs from the entire organisation.
```
git clone https://github.com/superfly/fly-log-shipper
cd fly-log-shipper
rm fly.toml

fly launch
```

- Overwrite fly-log-shipper's fly.toml with:
```
app = "<LEAVE AUTOGENERATED NAME>"

[metrics]
  port = 9598
  path = "/metrics"
```

- Setup secrets
```
fly secrets set \
    ORG=personal \
    ACCESS_TOKEN="$(fly auth token)" \
    HONEYCOMB_API_KEY="<INSERT HONEYCOMB API KEY HERE>" \
    HONEYCOMB_DATASET="fly-io-stack"
```

Remember to replace the value of `HONEYCOMB_API_KEY`, you can specify any name for `HONEYCOMB_DATASET`.

- Deploy fly-log-shipper
```
fly deploy
```

- At this point, all logs from the entire `personal` organisation should be visible in Honeycomb's dashboard
